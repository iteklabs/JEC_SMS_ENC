const a0_0x9a5616=a0_0x2ed1;function a0_0x2ed1(_0x48e6c4,_0xb6e2e9){const _0x383cfc=a0_0x383c();return a0_0x2ed1=function(_0x2ed11f,_0x4024b4){_0x2ed11f=_0x2ed11f-0x12d;let _0x5bfa9e=_0x383cfc[_0x2ed11f];return _0x5bfa9e;},a0_0x2ed1(_0x48e6c4,_0xb6e2e9);}(function(_0x1487c7,_0x2a006e){const _0xdb3f41=a0_0x2ed1,_0x43eb3b=_0x1487c7();while(!![]){try{const _0x7a5634=-parseInt(_0xdb3f41(0x14b))/0x1*(parseInt(_0xdb3f41(0x13d))/0x2)+-parseInt(_0xdb3f41(0x132))/0x3*(parseInt(_0xdb3f41(0x168))/0x4)+-parseInt(_0xdb3f41(0x15a))/0x5+-parseInt(_0xdb3f41(0x17c))/0x6+parseInt(_0xdb3f41(0x159))/0x7+parseInt(_0xdb3f41(0x13c))/0x8+-parseInt(_0xdb3f41(0x176))/0x9*(-parseInt(_0xdb3f41(0x137))/0xa);if(_0x7a5634===_0x2a006e)break;else _0x43eb3b['push'](_0x43eb3b['shift']());}catch(_0x243c99){_0x43eb3b['push'](_0x43eb3b['shift']());}}}(a0_0x383c,0x51984));const express=require('express'),app=express(),router=express[a0_0x9a5616(0x173)](),multer=require('multer'),{profile,master_shop,email_settings,warehouse,purchases,staff}=require(a0_0x9a5616(0x17f)),auth=require('../middleware/auth');var timezones=require('timezones-list');function a0_0x383c(){const _0x420a55=['$production_date','$product_details.expiry_date','user','$products','flash','Hindi','role','$name','$room','Router','$_id','All','171AmMHfq','Raw\x20Materials','message','$_id.level','/Rooms_data','$count','3074010ZpxfiN','en-US','$_id.bin','../models/all_models','$product_details.product_name','find','pack','DRY\x20STORAGE','log','$product_details.bay','7374wvDoQi','Portuguese\x20(BR)','/Rooms_data2','$_id.type','German','1131940imtavc','errors','Return\x20Goods','$product_details.type','Arabic','2715760oJIUlZ','427066FekLwu','$$product.product_quantity','status','success','$product_details.product_stock','/view','Enabled','language','email','$product_details.bin','product','Spanish','/MapData2','/staff_sales_id','3EMeHym','/Rooms_data3','English\x20(US)','/staff_sales','warehouse','findOne','$product_details','$_id.bay','$product_details.level','$batch_code','/MapData','Chinese','Arabic\x20(ae)','French','815479MHrhcq','2783125DlmmjH','aggregate','post','timezone','render','json','$_id.floorlevel','$product_details.floorlevel','$product_details.product_code','body','exports','$product_code','staff','$expiry_date','916djgKNG','English'];a0_0x383c=function(){return _0x420a55;};return a0_0x383c();}const users=require('../public/language/languages.json');router['get'](a0_0x9a5616(0x142),auth,async(_0x4b8e6a,_0x2b69fa)=>{const _0xc2dfdd=a0_0x9a5616;try{const {username:_0x631a05,email:_0x1e6740,role:_0x4f6252}=_0x4b8e6a[_0xc2dfdd(0x16c)],_0xbeec3e=_0x4b8e6a[_0xc2dfdd(0x16c)],_0x19d0fd=await profile['findOne']({'email':_0xbeec3e[_0xc2dfdd(0x145)]}),_0x164d97=await master_shop['find']();let _0x8bd53f;if(_0xbeec3e[_0xc2dfdd(0x170)]==_0xc2dfdd(0x166)){const _0x28e984=await staff[_0xc2dfdd(0x150)]({'email':_0xbeec3e[_0xc2dfdd(0x145)]});_0x8bd53f=await warehouse[_0xc2dfdd(0x15b)]([{'$match':{'status':_0xc2dfdd(0x143),'name':_0x28e984[_0xc2dfdd(0x14f)]}},{'$group':{'_id':'$name','name':{'$first':_0xc2dfdd(0x171)}}},{'$sort':{'name':-0x1}}]);}else _0x8bd53f=await warehouse[_0xc2dfdd(0x15b)]([{'$match':{'status':'Enabled'}},{'$group':{'_id':_0xc2dfdd(0x171),'name':{'$first':'$name'}}},{'$sort':{'name':-0x1}}]);const _0x1e8434=new Date()['toLocaleString'](_0xc2dfdd(0x17d),{'timeZone':_0x164d97[0x0][_0xc2dfdd(0x15d)]});if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x14d))var _0x1e5b46=users[_0xc2dfdd(0x169)];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x16f))var _0x1e5b46=users[_0xc2dfdd(0x16f)];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x136))var _0x1e5b46=users['German'];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x148))var _0x1e5b46=users[_0xc2dfdd(0x148)];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x158))var _0x1e5b46=users[_0xc2dfdd(0x158)];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x133))var _0x1e5b46=users['Portuguese'];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x156))var _0x1e5b46=users[_0xc2dfdd(0x156)];else{if(_0x164d97[0x0][_0xc2dfdd(0x144)]==_0xc2dfdd(0x157))var _0x1e5b46=users[_0xc2dfdd(0x13b)];}}}}}}}_0x2b69fa[_0xc2dfdd(0x15e)]('warehousemap_incoming',{'success':_0x4b8e6a[_0xc2dfdd(0x16e)](_0xc2dfdd(0x140)),'errors':_0x4b8e6a[_0xc2dfdd(0x16e)](_0xc2dfdd(0x138)),'role':_0xbeec3e,'profile':_0x19d0fd,'master_shop':_0x164d97,'timezones':timezones,'language':_0x1e5b46,'warehouse':_0x8bd53f});}catch(_0x26c49d){console[_0xc2dfdd(0x130)](_0x26c49d),_0x2b69fa['status'](0xc8)[_0xc2dfdd(0x15f)]({'message':_0x26c49d[_0xc2dfdd(0x178)]});}}),router['post'](a0_0x9a5616(0x155),async(_0x509516,_0x86eaa6)=>{const _0x5b170c=a0_0x9a5616,{warehouseNew:_0x3f93b0,rooms:_0x17770a,Type:_0x4ca419}=_0x509516[_0x5b170c(0x163)],_0x1731cf=await warehouse[_0x5b170c(0x15b)]([{'$unwind':_0x5b170c(0x151)},{'$match':{'name':_0x3f93b0,'room':_0x17770a,'product_details.type':_0x4ca419}},{'$group':{'_id':{'bay':_0x5b170c(0x131),'bin':_0x5b170c(0x146),'type':_0x5b170c(0x13a),'floorlevel':'$product_details.floorlevel'},'products':{'$push':{'product_name':'$product_details.product_name','product_quantity':_0x5b170c(0x141),'product_code':_0x5b170c(0x162)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x5b170c(0x141),0x0]},'then':_0x5b170c(0x141),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':'$_id.bay','bin':_0x5b170c(0x17e),'type':_0x5b170c(0x135),'floorlevel':_0x5b170c(0x160),'products':{'$filter':{'input':_0x5b170c(0x16d),'as':_0x5b170c(0x147),'cond':{'$gt':[_0x5b170c(0x13e),0x0]}}},'totalQuantity':0x1}}]);_0x86eaa6[_0x5b170c(0x15f)](_0x1731cf);}),router[a0_0x9a5616(0x15c)](a0_0x9a5616(0x149),async(_0x48baaf,_0x3cbd30)=>{const _0x1af8e0=a0_0x9a5616,{warehouseNew:_0x5e3302,rooms:_0x8ea9dd,room_cat:_0x1baf72}=_0x48baaf[_0x1af8e0(0x163)];let _0x2066c8;if(_0x1baf72==_0x1af8e0(0x175))_0x2066c8=await warehouse[_0x1af8e0(0x15b)]([{'$unwind':_0x1af8e0(0x151)},{'$match':{'name':_0x5e3302}},{'$group':{'_id':{'bay':_0x1af8e0(0x131),'product':'$product_details.product_name','expiry':_0x1af8e0(0x16b)},'count':{'$sum':_0x1af8e0(0x141)},'production_date':{'$first':'$product_details.production_date'},'expiry_date':{'$first':_0x1af8e0(0x16b)},'batch_code':{'$first':'$product_details.batch_code'},'product_code':{'$first':_0x1af8e0(0x162)}}},{'$group':{'_id':_0x1af8e0(0x152),'products':{'$push':{'product':'$_id.product','quantity':_0x1af8e0(0x17b),'production_date':_0x1af8e0(0x16a),'expiry_date':_0x1af8e0(0x167),'batch_code':_0x1af8e0(0x154),'product_code':_0x1af8e0(0x165)}},'totalQuantity':{'$sum':_0x1af8e0(0x17b)}}},{'$match':{'totalQuantity':{'$gt':0x0}}},{'$project':{'_id':0x0,'bay':_0x1af8e0(0x174),'products':0x1,'totalQuantity':0x1}}]),console[_0x1af8e0(0x130)](_0x1baf72);else{}_0x3cbd30[_0x1af8e0(0x15f)](_0x2066c8);}),router['post'](a0_0x9a5616(0x17a),async(_0xcc5704,_0x488d76)=>{const _0x460aaf=a0_0x9a5616;try{const {warehouse_name:_0x5de5ff}=_0xcc5704[_0x460aaf(0x163)];var _0x445921='';_0x445921=[{'$match':{'name':_0x5de5ff,'status':_0x460aaf(0x143)}},{'$group':{'_id':_0x460aaf(0x174),'room_name':{'$first':_0x460aaf(0x172)}}},{'$sort':{'room_name':0x1}}];const _0x40264d=await warehouse['aggregate'](_0x445921);_0x488d76[_0x460aaf(0x13f)](0xc8)[_0x460aaf(0x15f)](_0x40264d);}catch(_0x26c62b){_0x488d76[_0x460aaf(0x13f)](0x190)[_0x460aaf(0x15f)]({'errorMessage':_0x26c62b['message']});}}),router['post'](a0_0x9a5616(0x134),async(_0x4205ff,_0x21c33c)=>{const _0x44b3dd=a0_0x9a5616;try{const {warehouse_name:_0x1fe81c,cat:_0x2d6a00,valNew:_0x33b55b}=_0x4205ff['body'];var _0x13ad29='',_0x2a8769='';if(_0x2d6a00==_0x44b3dd(0x177))_0x13ad29=_0x44b3dd(0x139),_0x33b55b==_0x44b3dd(0x12e)?_0x2a8769=[{'$match':{'status':_0x44b3dd(0x143),'warehouse_category':_0x2d6a00,'name':{'$ne':_0x13ad29},'name':_0x44b3dd(0x12f)}},{'$group':{'_id':_0x44b3dd(0x171),'room_name':{'$first':_0x44b3dd(0x171)}}},{'$sort':{'room_name':0x1}}]:_0x2a8769=[{'$match':{'status':_0x44b3dd(0x143),'warehouse_category':_0x2d6a00,'name':{'$ne':_0x13ad29}}},{'$group':{'_id':_0x44b3dd(0x171),'room_name':{'$first':'$name'}}},{'$sort':{'room_name':0x1}}];else _0x2d6a00=='Finished\x20Goods'?(_0x13ad29='QA\x20Warehouse',_0x2a8769=[{'$match':{'status':_0x44b3dd(0x143),'warehouse_category':_0x2d6a00,'name':{'$ne':_0x13ad29}}},{'$group':{'_id':'$name','room_name':{'$first':'$name'}}},{'$sort':{'room_name':0x1}}]):_0x2a8769=[{'$match':{'status':_0x44b3dd(0x143)}},{'$group':{'_id':_0x44b3dd(0x171),'room_name':{'$first':_0x44b3dd(0x171)}}},{'$sort':{'room_name':0x1}}];const _0x537302=await warehouse[_0x44b3dd(0x15b)](_0x2a8769);_0x21c33c[_0x44b3dd(0x13f)](0xc8)[_0x44b3dd(0x15f)](_0x537302);}catch(_0x4e4d9f){_0x21c33c[_0x44b3dd(0x13f)](0x190)['json']({'errorMessage':_0x4e4d9f['message']}),console['log'](_0x4e4d9f);}}),router[a0_0x9a5616(0x15c)](a0_0x9a5616(0x14c),async(_0x45a024,_0x2733ce)=>{const _0x438d27=a0_0x9a5616;try{const {warehouse_name:_0x50cb83,cat:_0x29af39}=_0x45a024[_0x438d27(0x163)],_0x4fbb0e=await warehouse['aggregate']([{'$match':{'status':_0x438d27(0x143),'warehouse_category':_0x29af39,'name':_0x50cb83}},{'$group':{'_id':_0x438d27(0x172),'room_name':{'$first':_0x438d27(0x172)}}},{'$sort':{'room_name':0x1}}]);_0x2733ce[_0x438d27(0x13f)](0xc8)[_0x438d27(0x15f)](_0x4fbb0e);}catch(_0x4ad25e){_0x2733ce['status'](0x190)['json']({'errorMessage':_0x4ad25e[_0x438d27(0x178)]});}}),router['post'](a0_0x9a5616(0x14e),async(_0x4b4dda,_0x4be8c6)=>{const _0x5e7143=a0_0x9a5616;try{const {typeofsales:_0x4015c5}=_0x4b4dda['body'];var _0x3aee8a;_0x4015c5=='1'&&(_0x3aee8a=await staff[_0x5e7143(0x12d)]({'account_category':'sa','type_of_acc_cat':_0x4015c5})),_0x4be8c6[_0x5e7143(0x13f)](0xc8)[_0x5e7143(0x15f)](_0x3aee8a);}catch(_0x4264a1){_0x4be8c6[_0x5e7143(0x13f)](0x190)[_0x5e7143(0x15f)]({'errorMessage':_0x4264a1['message']});}}),router[a0_0x9a5616(0x15c)](a0_0x9a5616(0x14a),async(_0x298a0f,_0x2e6f8a)=>{const _0x4c5767=a0_0x9a5616;try{const {id:_0x428912}=_0x298a0f[_0x4c5767(0x163)],_0x4ebd22=await staff[_0x4c5767(0x12d)]({'_id':_0x428912});_0x2e6f8a[_0x4c5767(0x13f)](0xc8)[_0x4c5767(0x15f)](_0x4ebd22);}catch(_0x171a65){_0x2e6f8a[_0x4c5767(0x13f)](0x190)[_0x4c5767(0x15f)]({'errorMessage':_0x171a65[_0x4c5767(0x178)]});}}),router[a0_0x9a5616(0x15c)]('/map_value',async(_0x984d36,_0x3acc0a)=>{const _0x57efb6=a0_0x9a5616;try{const {warehouse_name:_0x54e0fa,room_value:_0x464a95}=_0x984d36[_0x57efb6(0x163)];let _0x471446;_0x464a95=='all'?_0x471446=await warehouse['aggregate']([{'$unwind':_0x57efb6(0x151)},{'$match':{'name':_0x54e0fa}},{'$group':{'_id':{'bay':'$product_details.bay','level':_0x57efb6(0x153),'type':_0x57efb6(0x13a),'floorlevel':_0x57efb6(0x161)},'products':{'$push':{'product_name':_0x57efb6(0x180),'product_quantity':_0x57efb6(0x141),'product_code':_0x57efb6(0x162)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x57efb6(0x141),0x0]},'then':_0x57efb6(0x141),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x57efb6(0x152),'level':_0x57efb6(0x179),'type':_0x57efb6(0x135),'floorlevel':_0x57efb6(0x160),'products':{'$filter':{'input':'$products','as':'product','cond':{'$gt':['$$product.product_quantity',0x0]}}},'totalQuantity':0x1}}]):_0x471446=await warehouse[_0x57efb6(0x15b)]([{'$unwind':_0x57efb6(0x151)},{'$match':{'name':_0x54e0fa,'room':_0x464a95}},{'$group':{'_id':{'bay':'$product_details.bay','level':_0x57efb6(0x153),'type':_0x57efb6(0x13a),'floorlevel':_0x57efb6(0x161)},'products':{'$push':{'product_name':'$product_details.product_name','product_quantity':_0x57efb6(0x141),'product_code':_0x57efb6(0x162)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x57efb6(0x141),0x0]},'then':'$product_details.product_stock','else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x57efb6(0x152),'level':'$_id.level','type':_0x57efb6(0x135),'floorlevel':_0x57efb6(0x160),'products':{'$filter':{'input':_0x57efb6(0x16d),'as':_0x57efb6(0x147),'cond':{'$gt':[_0x57efb6(0x13e),0x0]}}},'totalQuantity':0x1}}]),_0x3acc0a[_0x57efb6(0x13f)](0xc8)['json'](_0x471446);}catch(_0x28ea2c){_0x3acc0a[_0x57efb6(0x13f)](0x190)['json']({'errorMessage':_0x28ea2c[_0x57efb6(0x178)]});}}),module[a0_0x9a5616(0x164)]=router;