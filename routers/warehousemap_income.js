const a0_0x5bb960=a0_0x5729;(function(_0x1b1bc7,_0x249554){const _0x220aca=a0_0x5729,_0x19ad4d=_0x1b1bc7();while(!![]){try{const _0x8c6d0c=parseInt(_0x220aca(0x127))/0x1*(-parseInt(_0x220aca(0x13c))/0x2)+-parseInt(_0x220aca(0x164))/0x3+parseInt(_0x220aca(0x149))/0x4*(parseInt(_0x220aca(0x129))/0x5)+-parseInt(_0x220aca(0x13e))/0x6*(-parseInt(_0x220aca(0x12a))/0x7)+-parseInt(_0x220aca(0x132))/0x8+-parseInt(_0x220aca(0x169))/0x9*(-parseInt(_0x220aca(0x124))/0xa)+parseInt(_0x220aca(0x12e))/0xb*(parseInt(_0x220aca(0x131))/0xc);if(_0x8c6d0c===_0x249554)break;else _0x19ad4d['push'](_0x19ad4d['shift']());}catch(_0x483c4d){_0x19ad4d['push'](_0x19ad4d['shift']());}}}(a0_0x4d4a,0xa9c5b));const express=require('express'),app=express(),router=express['Router'](),multer=require(a0_0x5bb960(0x11a)),{profile,master_shop,email_settings,warehouse,purchases,staff}=require(a0_0x5bb960(0x12c)),auth=require('../middleware/auth');var timezones=require(a0_0x5bb960(0x117));function a0_0x5729(_0x16f9f9,_0x475dfc){const _0x4d4a5a=a0_0x4d4a();return a0_0x5729=function(_0x57292c,_0x95b74d){_0x57292c=_0x57292c-0x117;let _0x583920=_0x4d4a5a[_0x57292c];return _0x583920;},a0_0x5729(_0x16f9f9,_0x475dfc);}const users=require(a0_0x5bb960(0x134));router[a0_0x5bb960(0x130)](a0_0x5bb960(0x15b),auth,async(_0x9518bc,_0x2d5f9b)=>{const _0x413fbb=a0_0x5bb960;try{const {username:_0x19c806,email:_0x71ca15,role:_0x2a2082}=_0x9518bc['user'],_0x534838=_0x9518bc[_0x413fbb(0x12d)],_0x2353bf=await profile[_0x413fbb(0x16a)]({'email':_0x534838[_0x413fbb(0x14e)]}),_0x2961cf=await master_shop[_0x413fbb(0x143)]();let _0x52cfac;if(_0x534838[_0x413fbb(0x133)]=='staff'){const _0x1eb44f=await staff['findOne']({'email':_0x534838[_0x413fbb(0x14e)]});_0x52cfac=await warehouse['aggregate']([{'$match':{'status':_0x413fbb(0x141),'name':_0x1eb44f[_0x413fbb(0x13f)]}},{'$group':{'_id':'$name','name':{'$first':_0x413fbb(0x14d)}}},{'$sort':{'name':-0x1}}]);}else _0x52cfac=await warehouse[_0x413fbb(0x136)]([{'$match':{'status':_0x413fbb(0x141)}},{'$group':{'_id':'$name','name':{'$first':'$name'}}},{'$sort':{'name':-0x1}}]);const _0x468205=new Date()['toLocaleString']('en-US',{'timeZone':_0x2961cf[0x0][_0x413fbb(0x15e)]});if(_0x2961cf[0x0]['language']==_0x413fbb(0x167))var _0x192624=users[_0x413fbb(0x150)];else{if(_0x2961cf[0x0][_0x413fbb(0x121)]=='Hindi')var _0x192624=users['Hindi'];else{if(_0x2961cf[0x0]['language']=='German')var _0x192624=users[_0x413fbb(0x161)];else{if(_0x2961cf[0x0]['language']==_0x413fbb(0x13a))var _0x192624=users[_0x413fbb(0x13a)];else{if(_0x2961cf[0x0][_0x413fbb(0x121)]==_0x413fbb(0x147))var _0x192624=users[_0x413fbb(0x147)];else{if(_0x2961cf[0x0][_0x413fbb(0x121)]==_0x413fbb(0x122))var _0x192624=users[_0x413fbb(0x14c)];else{if(_0x2961cf[0x0]['language']==_0x413fbb(0x155))var _0x192624=users[_0x413fbb(0x155)];else{if(_0x2961cf[0x0][_0x413fbb(0x121)]==_0x413fbb(0x12f))var _0x192624=users['Arabic'];}}}}}}}_0x2d5f9b[_0x413fbb(0x142)](_0x413fbb(0x125),{'success':_0x9518bc['flash'](_0x413fbb(0x14f)),'errors':_0x9518bc[_0x413fbb(0x166)](_0x413fbb(0x145)),'role':_0x534838,'profile':_0x2353bf,'master_shop':_0x2961cf,'timezones':timezones,'language':_0x192624,'warehouse':_0x52cfac});}catch(_0x3d79cd){console[_0x413fbb(0x11c)](_0x3d79cd),_0x2d5f9b[_0x413fbb(0x137)](0xc8)[_0x413fbb(0x118)]({'message':_0x3d79cd[_0x413fbb(0x157)]});}}),router[a0_0x5bb960(0x165)](a0_0x5bb960(0x146),async(_0x464f1a,_0xe05402)=>{const _0x5769e8=a0_0x5bb960,{warehouseNew:_0x17e994,rooms:_0x324c5c,Type:_0x231083}=_0x464f1a['body'],_0x1b1cdc=await warehouse['aggregate']([{'$unwind':_0x5769e8(0x159)},{'$match':{'name':_0x17e994,'room':_0x324c5c,'product_details.type':_0x231083}},{'$group':{'_id':{'bay':_0x5769e8(0x160),'bin':_0x5769e8(0x138),'type':_0x5769e8(0x16c),'floorlevel':_0x5769e8(0x151)},'products':{'$push':{'product_name':'$product_details.product_name','product_quantity':_0x5769e8(0x158),'product_code':'$product_details.product_code'}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':['$product_details.product_stock',0x0]},'then':_0x5769e8(0x158),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x5769e8(0x13d),'bin':_0x5769e8(0x14b),'type':_0x5769e8(0x11d),'floorlevel':_0x5769e8(0x140),'products':{'$filter':{'input':_0x5769e8(0x12b),'as':_0x5769e8(0x11b),'cond':{'$gt':[_0x5769e8(0x152),0x0]}}},'totalQuantity':0x1}}]);_0xe05402[_0x5769e8(0x118)](_0x1b1cdc);}),router['post'](a0_0x5bb960(0x13b),async(_0x1622c3,_0x402115)=>{const _0x21eedc=a0_0x5bb960,{warehouseNew:_0x1939c7,rooms:_0x3e9d47,room_cat:_0xa20187}=_0x1622c3[_0x21eedc(0x119)];let _0x5cf347;if(_0xa20187==_0x21eedc(0x120))_0x5cf347=await warehouse[_0x21eedc(0x136)]([{'$unwind':_0x21eedc(0x159)},{'$match':{'name':_0x1939c7}},{'$group':{'_id':{'bay':'$product_details.bay','product':_0x21eedc(0x128),'expiry':_0x21eedc(0x153)},'count':{'$sum':_0x21eedc(0x158)},'production_date':{'$first':_0x21eedc(0x15a)},'expiry_date':{'$first':_0x21eedc(0x153)},'batch_code':{'$first':'$product_details.batch_code'},'product_code':{'$first':_0x21eedc(0x163)}}},{'$group':{'_id':_0x21eedc(0x13d),'products':{'$push':{'product':'$_id.product','quantity':_0x21eedc(0x168),'production_date':'$production_date','expiry_date':_0x21eedc(0x154),'batch_code':_0x21eedc(0x135),'product_code':_0x21eedc(0x16b)}},'totalQuantity':{'$sum':_0x21eedc(0x168)}}},{'$match':{'totalQuantity':{'$gt':0x0}}},{'$project':{'_id':0x0,'bay':_0x21eedc(0x11e),'products':0x1,'totalQuantity':0x1}}]),console[_0x21eedc(0x11c)](_0xa20187);else{}_0x402115[_0x21eedc(0x118)](_0x5cf347);}),router['post']('/Rooms_data',async(_0x5d73cf,_0x4adf23)=>{const _0x238e33=a0_0x5bb960;try{const {warehouse_name:_0xfd7bc4}=_0x5d73cf[_0x238e33(0x119)];var _0x7bd514='';_0x7bd514=[{'$match':{'name':_0xfd7bc4,'status':_0x238e33(0x141)}},{'$group':{'_id':_0x238e33(0x11e),'room_name':{'$first':_0x238e33(0x11f)}}},{'$sort':{'room_name':0x1}}];const _0x358117=await warehouse[_0x238e33(0x136)](_0x7bd514);_0x4adf23[_0x238e33(0x137)](0xc8)['json'](_0x358117);}catch(_0x1cfc98){_0x4adf23[_0x238e33(0x137)](0x190)['json']({'errorMessage':_0x1cfc98[_0x238e33(0x157)]});}}),router[a0_0x5bb960(0x165)](a0_0x5bb960(0x15f),async(_0x25fcd2,_0x3c9429)=>{const _0x152b5d=a0_0x5bb960;try{const {warehouse_name:_0x31506a,cat:_0x571408,valNew:_0x29a739}=_0x25fcd2['body'];var _0x4f4725='',_0x12b1fe='';if(_0x571408==_0x152b5d(0x139))_0x4f4725=_0x152b5d(0x156),_0x29a739=='pack'?_0x12b1fe=[{'$match':{'status':'Enabled','warehouse_category':_0x571408,'name':{'$ne':_0x4f4725},'name':_0x152b5d(0x123)}},{'$group':{'_id':_0x152b5d(0x14d),'room_name':{'$first':_0x152b5d(0x14d)}}},{'$sort':{'room_name':0x1}}]:_0x12b1fe=[{'$match':{'status':'Enabled','warehouse_category':_0x571408,'name':{'$ne':_0x4f4725}}},{'$group':{'_id':_0x152b5d(0x14d),'room_name':{'$first':'$name'}}},{'$sort':{'room_name':0x1}}];else _0x571408==_0x152b5d(0x15c)?(_0x4f4725=_0x152b5d(0x126),_0x12b1fe=[{'$match':{'status':'Enabled','warehouse_category':_0x571408,'name':{'$ne':_0x4f4725}}},{'$group':{'_id':_0x152b5d(0x14d),'room_name':{'$first':'$name'}}},{'$sort':{'room_name':0x1}}]):_0x12b1fe=[{'$match':{'status':_0x152b5d(0x141)}},{'$group':{'_id':_0x152b5d(0x14d),'room_name':{'$first':_0x152b5d(0x14d)}}},{'$sort':{'room_name':0x1}}];const _0x4b8730=await warehouse[_0x152b5d(0x136)](_0x12b1fe);_0x3c9429['status'](0xc8)['json'](_0x4b8730);}catch(_0x3ab282){_0x3c9429[_0x152b5d(0x137)](0x190)[_0x152b5d(0x118)]({'errorMessage':_0x3ab282['message']}),console['log'](_0x3ab282);}}),router[a0_0x5bb960(0x165)]('/Rooms_data3',async(_0x4727ed,_0x172ef6)=>{const _0x23db41=a0_0x5bb960;try{const {warehouse_name:_0x313775,cat:_0x35d6e7}=_0x4727ed[_0x23db41(0x119)],_0x409760=await warehouse[_0x23db41(0x136)]([{'$match':{'status':'Enabled','warehouse_category':_0x35d6e7,'name':_0x313775}},{'$group':{'_id':_0x23db41(0x11f),'room_name':{'$first':_0x23db41(0x11f)}}},{'$sort':{'room_name':0x1}}]);_0x172ef6[_0x23db41(0x137)](0xc8)[_0x23db41(0x118)](_0x409760);}catch(_0x5aa8f5){_0x172ef6[_0x23db41(0x137)](0x190)[_0x23db41(0x118)]({'errorMessage':_0x5aa8f5['message']});}}),router['post']('/staff_sales',async(_0x2c5caf,_0x4d8c61)=>{const _0x5d267a=a0_0x5bb960;try{const {typeofsales:_0x3b9242}=_0x2c5caf['body'],_0x84a079=await staff['find']({'account_category':'sa','type_of_acc_cat':_0x3b9242});_0x4d8c61[_0x5d267a(0x137)](0xc8)[_0x5d267a(0x118)](_0x84a079);}catch(_0xe93c64){_0x4d8c61[_0x5d267a(0x137)](0x190)[_0x5d267a(0x118)]({'errorMessage':_0xe93c64[_0x5d267a(0x157)]});}}),router[a0_0x5bb960(0x165)](a0_0x5bb960(0x144),async(_0x33e539,_0x52d453)=>{const _0x3e6233=a0_0x5bb960;try{const {id:_0x1d035b}=_0x33e539[_0x3e6233(0x119)],_0x3ff431=await staff['find']({'_id':_0x1d035b});_0x52d453[_0x3e6233(0x137)](0xc8)[_0x3e6233(0x118)](_0x3ff431);}catch(_0x4b7c9f){_0x52d453[_0x3e6233(0x137)](0x190)['json']({'errorMessage':_0x4b7c9f[_0x3e6233(0x157)]});}}),router[a0_0x5bb960(0x165)]('/map_value',async(_0x435cd3,_0xf6d170)=>{const _0x356743=a0_0x5bb960;try{const {warehouse_name:_0x5424bd,room_value:_0x3ec1d1}=_0x435cd3[_0x356743(0x119)];let _0x3426ab;_0x3ec1d1==_0x356743(0x162)?_0x3426ab=await warehouse['aggregate']([{'$unwind':_0x356743(0x159)},{'$match':{'name':_0x5424bd}},{'$group':{'_id':{'bay':_0x356743(0x160),'level':_0x356743(0x148),'type':_0x356743(0x16c),'floorlevel':_0x356743(0x151)},'products':{'$push':{'product_name':_0x356743(0x128),'product_quantity':_0x356743(0x158),'product_code':_0x356743(0x163)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x356743(0x158),0x0]},'then':_0x356743(0x158),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':_0x356743(0x13d),'level':_0x356743(0x14a),'type':_0x356743(0x11d),'floorlevel':'$_id.floorlevel','products':{'$filter':{'input':_0x356743(0x12b),'as':_0x356743(0x11b),'cond':{'$gt':[_0x356743(0x152),0x0]}}},'totalQuantity':0x1}}]):_0x3426ab=await warehouse['aggregate']([{'$unwind':_0x356743(0x159)},{'$match':{'name':_0x5424bd,'room':_0x3ec1d1}},{'$group':{'_id':{'bay':_0x356743(0x160),'level':_0x356743(0x148),'type':_0x356743(0x16c),'floorlevel':_0x356743(0x151)},'products':{'$push':{'product_name':_0x356743(0x128),'product_quantity':'$product_details.product_stock','product_code':_0x356743(0x163)}},'totalQuantity':{'$sum':{'$cond':{'if':{'$gt':[_0x356743(0x158),0x0]},'then':_0x356743(0x158),'else':0x0}}}}},{'$project':{'_id':0x0,'bay':'$_id.bay','level':'$_id.level','type':_0x356743(0x11d),'floorlevel':_0x356743(0x140),'products':{'$filter':{'input':_0x356743(0x12b),'as':_0x356743(0x11b),'cond':{'$gt':['$$product.product_quantity',0x0]}}},'totalQuantity':0x1}}]),_0xf6d170['status'](0xc8)[_0x356743(0x118)](_0x3426ab);}catch(_0x29c9d6){_0xf6d170['status'](0x190)[_0x356743(0x118)]({'errorMessage':_0x29c9d6[_0x356743(0x157)]});}}),module[a0_0x5bb960(0x15d)]=router;function a0_0x4d4a(){const _0x2310a0=['3497952cZoZCo','post','flash','English\x20(US)','$count','9qSyYVG','findOne','$product_code','$product_details.type','timezones-list','json','body','multer','product','log','$_id.type','$_id','$room','All','language','Portuguese\x20(BR)','DRY\x20STORAGE','70910fGypnH','warehousemap_incoming','QA\x20Warehouse','1dbCNvU','$product_details.product_name','361015owchOI','1656613KGtKxw','$products','../models/all_models','user','27151234xACVub','Arabic\x20(ae)','get','12UPDPIP','2138512TyJeAI','role','../public/language/languages.json','$batch_code','aggregate','status','$product_details.bin','Raw\x20Materials','Spanish','/MapData2','1744342VSpMKy','$_id.bay','6tlPKZm','warehouse','$_id.floorlevel','Enabled','render','find','/staff_sales_id','errors','/MapData','French','$product_details.level','16qQViTs','$_id.level','$_id.bin','Portuguese','$name','email','success','English','$product_details.floorlevel','$$product.product_quantity','$product_details.expiry_date','$expiry_date','Chinese','Return\x20Goods','message','$product_details.product_stock','$product_details','$product_details.production_date','/view','Finished\x20Goods','exports','timezone','/Rooms_data2','$product_details.bay','German','all','$product_details.product_code'];a0_0x4d4a=function(){return _0x2310a0;};return a0_0x4d4a();}